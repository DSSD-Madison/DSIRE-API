<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link type="text/css" rel="stylesheet" href="../styles/demo.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;700&family=PT+Sans:wght@700&display=swap">

    <script
      src="https://unpkg.com/react@17/umd/react.development.js"
    ></script>
    <script
      src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"
    ></script>

    <title>DSIRE API Documentation</title>
</head>

<body>
    <div id="meta">
        <h1 id="DSIRE">DSIRE API Documentation</h1>
        <h2 id="subtitle">Register for an API token <a href="../registration.html">here</a>.</h2>
        <!--<span>
            <img src="../images/dsire.png">
            <img src="../images/ncce.png">
        </span>-->
        <div id="navbar">
            <span><a href="#rest_docs"><h2 style="color:lightgrey">REST ENDPOINT</h2></a>
            <a href="#graphql_docs"><h2 style="color:lightgrey">GRAPHQL ENDPOINT</h2></a>
            <a href="#graphql_demo"><h2 style="color:lightgrey">GRAPHQL DEMO</h2></a></span>
        </div>
    </div>
    <div id="content">
        <div>
            <span>
                <h2><span class="method">GET</span> /graphql: <i style="color:lightgrey">Allows users to ask our database for exactly what they need</i></h2>
            </span>
            <h4 class="subheader">HEADERS <span style="color: #696969; background-color: lightgrey; padding:5px; border-radius:10px;">REQUIRED</span></h4>
            <div class="details">
                <h5><span class="query-example">"Authorization: {token}"</span></h5>
                <h5>The user token provided via email after registration approval.</br>This token will expire after 365 days and users will need to register again to receive approval and a new token.</br></h5>
                <h5><span class="example">Example value: </span></br><span class="example-value">"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"</span></h5>
            </div>
            <h4 class="subheader">TRY THE ENDPOINT HERE!</h4>
            <embed type="text/html" src="../graphiql.html" width="100%" height="800">
        </div>
            
        <div id="rest_doc">
            <span>
                <h2><span class="method">GET</span> /query: <i style="color:lightgrey">The primary REST endpoint for querying the API</i></h2>
            </span>
            
            <h4 class="subheader">HEADERS <span style="color: #696969; background-color: lightgrey; padding:5px; border-radius:10px;">REQUIRED</span></h4>
            <div class="details">
                <h5><span class="query-example">"Authorization: {token}"</span></h5>
                <h5>The user token provided via email after registration approval.</br>This token will expire after 365 days and users will need to register again to receive approval and a new token.</br></h5>
                <h5><span class="example">Example value: </span></br><span class="example-value">"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c"</span></h5>
            </div>
            <h4 class="subheader">PARAMETERS</h4>
            <div class="details">
                <h5><span class="query-example">/query?states=[str,...]</span></h5>
                <h5>Restrict data to a comma-separated list of states.
                </br>States are specified by their US postal abbreviation (MN, IA, WI) or US for nation-wide; some special territory abbreviations are available.
                </br><u>Querying any invalid state will result in an <span class="error">error response.</span></u></h5>
                <h5><span class="example">Example value: </span><span class="example-value">states=["MN","IA","WI"]</span></h5>
            </div>
            <div class="details">
                <h5><span class="query-example">/query?category="FI"|"RP"</span></h5>
                <h5>Restrict data returned to either Financial Incentives ("FI") or Regulatory Policies ("RP").
                </br>When unspecified, data represents both types of benefits.
                </br>FI or RP can be upper-, lower-, or mixed-case i.e. FI, fi, Fi.
                </br>Querying any invalid policy (anything not "FI" or "RP") is ignored.
                </br><u>Querying both valid categories will result in an <span class="error">error response.</span></u></h5>
                <h5><span class="example">Example value: </span><span class="example-value">category="RP"</span></h5>
            </div>
            <div class="details">
                <h5><span class="query-example">/query?pageSize=int:50</span></h5>
                <h5>Limit the maximum quantity of incentives to the provided value.
                </br>Defaults to 50 entries.
                </br>Querying with a page size of 0 allows you to determine the size of the query without moving any data.
                </br>Querying a negative value or a non-integer is ignored for the default.</h5>
                <h5><span class="example">Example value: </span><span class="example-value">pageSize=int:25</span></h5>
            </div>
            <div class="details">
                <h5><span class="query-example">/query?page=int:0</span></h5>
                <h5>Specify which page of incentives to retrieve. Pages are indexed from 0 (if 5 pages are available, valid pages to request are 0 through 4, inclusive).
                </br>Negative values can be used to query from the end of the results: if 10 pages (0-9) are available...
                <span class="code">page=0</span>, <span class="code">page=1</span> query pages 0 and 1, respectively
                <span class="code">page=-1</span>, <span class="code">page=-2</span> query pages 9 and 8, respectively
                </br>Querying a non-integer page value is ignored.
                </br><u>Querying a page value outside of the possible page range will result in an <span class="error">error response.</span></u></h5>
                <h5><span class="example">Example value: </span><span class="example-value">page=int:9</span></h5>
            </div>
            <h4 class="subheader">EXAMPLES</h4>
            <div class="details">
                <code>curl -H "Authorization: {token}" https://{dsire api url}/query?states=["CA","NY"]&page=0&page=1</code></br></br>
                <code>curl -H "Authorization: {token}" https://{dsire api url}/query?states=["WI"]&category="FI"&pageSize=int:10</code>
            </div>
            <h4 class="subheader">RESPONSES</h4>
            <div class="details">
                <h5><span style="color: green; font-weight:bolder;">SUCCESS</span></h5>
                <h5>Code: <span class="success">200</span> OK</h5>
                <h5>Body: text/json</h5>
                <pre>
                    <code>
                    {
                        "incentives": [
                            {
                                "name": "Building Energy Code",
                                "state": "Colorado",
                                "shortState": "CO",
                                "category": "Financial Incentive",
                                "type": "Rebate Program",
                                "startDate": "2003-02-02",
                                "endDate": "2004-08-21",
                                "url": "co.gov/code"
                            },
                        ],
                        "page": 0,
                        "pages": 3,
                        "pageSize": 50,
                        "results": 4815
                    }
                    </code>
                </pre>
            </div>
            <div class="details">
                <h5><span style="color: #c00; font-weight:bolder;">ERROR</span></h5>
                <h5>Code: <span class="failure">400</span> BAD REQUEST with malformed query parameter <span class="query-example">&state=</span></h5>
                <h5>Body: text/json</h5>
                <pre>
                    <code>
                    {
                        "error": {
                            "code": 400,
                            "message": "Malformed states in query: ['NP', 'MP']"
                        }
                    }
                    </code>
                </pre>
            </div>
            <div class="details">
                <h5><span style="color: #c00; font-weight:bolder;">ERROR</span></h5>
                <h5>Code: <span class="failure">400</span> BAD REQUEST with malformed query parameter <span class="query-example">&category=</span></h5>
                <h5>Body: text/json</h5>
                <pre>
                    <code>
                    {
                        "error": {
                            "code": 400,
                            "message": "Queried both FI and RP; only one per request is well-defined"
                        }
                    }
                    </code>
                </pre>
            </div>
            <div class="details">
                <h5><span style="color: #c00; font-weight:bolder;">ERROR</span></h5>
                <h5>Code: <span class="failure">400</span> BAD REQUEST with out-of-range query parameter <span class="query-example">&page=</span></h5>
                <h5>Body: text/json</h5>
                <pre>
                    <code>
                    {
                        "error": {
                            "code": 400,
                            "message": "Requested page 42; maximum was 23 for pageSize=1000"
                        }
                    }
                    </code>
                </pre>
            </div>
        </div>
    </div>
</body>